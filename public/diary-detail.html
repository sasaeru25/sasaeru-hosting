<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>è¨˜éŒ²ã®è©³ç´°</title>

  <!-- èŠ¯ï¼ˆå…±é€šãƒ»å¿…é ˆï¼‰ -->
  <link rel="stylesheet" href="/css/common.css">
  <script defer src="/js/lib.js"></script>
  <script defer src="/js/store.js"></script>

  <meta name="theme-color" content="#FFF9F2">

  <style>
    :root{--bg:#FFF9F2;--accent:#FFDC65;--purple:#6a1b9a;--border:#e6e6e6;
          --safe-bottom:env(safe-area-inset-bottom);}
    body{background:var(--bg);}

    .detail-page{box-sizing:border-box;max-width:560px;margin:0 auto;
      padding:18px 16px 28px;color:#333;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;}

    .page-head{display:flex;gap:.6rem;align-items:center;justify-content:center;margin-bottom:12px;}
    .page-head h2{margin:0;font-size:1.05rem;padding:.35rem .9rem;background:#fff;
      border:1px solid var(--border);border-radius:999px;}

    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:14px;
      box-shadow:0 3px 10px rgba(0,0,0,.06);text-align:left;}

    .meta{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:10px;}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;
      background:var(--accent);font-weight:800;font-size:.92rem;}
    .sub{color:#666;font-size:.85rem;}

    .ttl{margin:10px 0 12px;font-size:1.1rem;font-weight:800;line-height:1.35;}
    .body{white-space:pre-wrap;line-height:1.75;font-size:1rem;}

    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap;}
    .btn-primary,.btn-secondary,.btn-danger{
      min-height:44px;padding:10px 16px;border-radius:12px;cursor:pointer;font-size:1rem;
      border:1px solid #d9d9d9;background:#fff;}
    .btn-primary{background:var(--accent);border:none;font-weight:800;
      box-shadow:0 3px 6px rgba(0,0,0,.15);}
    .btn-danger{border:1px solid #ef4444;color:#ef4444;font-weight:800;}

    .bottom-links{margin-top:16px;text-align:center;display:flex;justify-content:center;
      gap:18px;flex-wrap:wrap;}
    .purple{color:var(--purple);text-decoration:none;font-weight:800;}

    @media(max-width:430px){
      .detail-page{padding:16px 14px 24px;}
      .page-head h2{font-size:1rem;}
      .ttl{font-size:1.05rem;}
    }

    main{padding-bottom:calc(28px + var(--safe-bottom));}
  </style>
</head>

<body>
<main class="detail-page" aria-labelledby="detail-title">
  <div class="page-head"><h2 id="detail-title">ğŸ¤ è¨˜éŒ²ã®è©³ç´° ğŸ¤</h2></div>

  <!-- è©³ç´°ã‚«ãƒ¼ãƒ‰ -->
  <section class="card" id="card" hidden>
    <div class="meta">
      <span class="badge" id="dateText">æ—¥ä»˜</span>
      <span class="sub"   id="timeText"></span>
    </div>

    <div class="ttl"  id="titleText"></div>
    <div class="body" id="bodyText"></div>

    <div class="actions">
      <button type="button" class="btn-secondary" id="btn-back">æˆ»ã‚‹</button>
      <button type="button" class="btn-primary"  id="btn-edit">ç·¨é›†</button>
      <button type="button" class="btn-danger"   id="btn-del">å‰Šé™¤</button>
    </div>
  </section>

  <!-- 404 ç›¸å½“ -->
  <section class="card" id="notfound" hidden>
    <div style="font-weight:800;margin-bottom:8px;">è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
    <div style="color:#666;line-height:1.7;">è¨˜éŒ²ãŒå‰Šé™¤ã•ã‚ŒãŸã‹ã€URL ã®æŒ‡å®šãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    <div class="actions" style="justify-content:center;margin-top:14px;">
      <button class="btn-primary" id="nf-top" type="button">ä¸€è¦§ã¸</button>
    </div>
  </section>

  <nav class="bottom-links" aria-label="ãƒªãƒ³ã‚¯">
    <a href="?page=diary"      class="purple" id="lnk-top">â† è¨˜éŒ²ãƒˆãƒƒãƒ—</a>
    <a href="?page=diary-list" class="purple" id="lnk-list">ä¸€è¦§è¡¨ç¤º</a>
  </nav>
</main>

<script>
(async () => {
  // èŠ¯ï¼ˆstore.jsï¼‰ãŒç”¨æ„ã™ã‚‹æƒ³å®š
  const loadRecords = window.loadRecords;
  const saveRecords = window.saveRecords;

  const params = new URL(location.href).searchParams;
  const id = params.get('id');

  const $card      = document.getElementById('card');
  const $nf        = document.getElementById('notfound');
  const $dateText  = document.getElementById('dateText');
  const $timeText  = document.getElementById('timeText');
  const $titleText = document.getElementById('titleText');
  const $bodyText  = document.getElementById('bodyText');

  // go() ãŒã‚ã‚Œã°çµ±ä¸€ã€ãªã‘ã‚Œã° location.href ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const nav = (page, qs='') => {
    if (typeof window.go === 'function') return window.go(page, qs);
    location.href = `?page=${encodeURIComponent(page)}${qs ? `&${qs}` : ''}`;
  };

  document.getElementById('lnk-top').addEventListener('click', (e)=>{ e.preventDefault(); nav('diary'); });
  document.getElementById('lnk-list').addEventListener('click',(e)=>{ e.preventDefault(); nav('diary-list'); });
  document.getElementById('nf-top').onclick = ()=> nav('diary-list');

  // ã‚¹ãƒˆã‚¢æœªæº–å‚™ãªã‚‰ã€Œè¦‹ã¤ã‹ã‚‰ãªã„ã€æ‰±ã„ã«ã—ãªã„ï¼ˆäº‹æ•…é˜²æ­¢ï¼‰
  if (!loadRecords || !saveRecords){
    $nf.hidden = false;
    $nf.querySelector('div:nth-child(2)').textContent =
      'èª­ã¿è¾¼ã¿æº–å‚™ä¸­ã§ã™ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰æˆ»ã£ã¦ãã ã•ã„ï¼ˆstore.js ãŒèª­ã¿è¾¼ã‚ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚';
    return;
  }

  if (!id){
    $nf.hidden = false;
    return;
  }

  const all = await loadRecords();
  const rec = all.find(r => String(r.id) === String(id));

  if (!rec){
    $nf.hidden = false;
    return;
  }

  const ts  = rec.recordDate ?? rec.createdAt;
  const d   = new Date(ts);
  const pad = n => String(n).padStart(2,'0');
  const ymd = `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
  const hm  = `${pad(d.getHours())}:${pad(d.getMinutes())}`;

  $dateText.textContent  = rec.dateText || ymd;
  $timeText.textContent  = `${ymd} ${hm}`;
  $titleText.textContent = (rec.title && rec.title.trim()) ? rec.title.trim() : 'ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰';
  $bodyText.textContent  = rec.content || '';

  $card.hidden = false;

  document.getElementById('btn-back').onclick = ()=> nav('diary-list');
  document.getElementById('btn-edit').onclick = ()=> nav('diary-new', `edit=${encodeURIComponent(rec.id)}`);

  document.getElementById('btn-del').onclick  = async()=>{
    if (!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    await saveRecords(all.filter(r => String(r.id) !== String(rec.id)));
    nav('diary-list');
  };
})();
</script>

</body>
</html>
